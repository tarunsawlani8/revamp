<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
      <link rel="shortcut icon" href="favicon.ico"  type="image/x-icon"/>

    <title>Amar Opticals | Eyeglasses, Sunglasses & Contact Lenses</title>

    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="../../dist/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="../../resources/demos/style.css">
  
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="home.html">AMAR OPTICALS.IN</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li ><a href="home.html">Home</a></li>
            <li class="dropdown">
            
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Orders <span class="caret"></span></a>
              <ul class="dropdown-menu">
                      <li><a href="dashboard.html">Add Orders</a></li>
                <li><a href="searchorders.html">Search Orders</a></li>
                
              </ul>
            
            </li>
            <li class="active" style="align:right;"><a href="#about">Hello</a></li>
			<li ><a  href="home.html" style="align:right;">Logout</a></li>
       <!--     <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>-->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">   
      <div ng-app="myApp" ng-controller="customersCtrl">          
         <div class="page-header">
        <h1>Search Records</h1>
      </div>
	        <div  id="successMsg" class="alert alert-success alert-dismissible">
	   
        <strong>Well done!</strong> You successfully read this important alert message.
      </div>
     
      <div id="errorMsg" class="alert alert-danger alert-dismissible">
        <strong>Thats!</strong> Server Connection Error!!!Please check your Internet Connection
      </div>
     
    <form id="searchOrderForm"  autocomplete="off">	  
<input type="hidden"  name="pageAction" ng-model="pageAction" value="searchRecords"/>
<div class="form-group row" >	
  <label for="orderId" class="col-sm-2">Order Id:</label>
  <input type="text" class="form-control col-sm-2"   style="width:auto;" placeholder="Order Id" name="orderId" id="orderId" data-validation="length alphanumeric">

 <label for="customerName" class="col-sm-2">Customer Name:</label>
  <input type="text" class="form-control col-sm-2" style="width:auto;" placeholder="Customer Name" name="customerName" id="customerName" data-validation="length alphanumeric">

 <label for="deliveryStatus" class="col-sm-2">Delivery Status:</label>
  <select  class="form-control col-sm-2" style="width:auto;" name="deliveryStatus" id="deliveryStatus" data-validation="length alphanumeric">

<option selected="selected" value="">SELECT</option>
<option  value="IN PROGRESS">IN PROGRESS</option>
<option  value="READY FOR PICKUP">READY FOR PICKUP</option>
<option  value="DELIVERED">DELIVERED</option>
</select>
</div>

 



    <button  id="searchOrderBtn" type="submit" class="btn btn btn-default " style="width:auto"; ng-click="searchRecords()"  font-weight:bold;">Search</button>
</form>

<div class="row">
 <!-- <div class="col-sm-12"> -->
     <form id="updateOrdersForm">
     <input type="hidden" name="pageAction" value="updateOrders">
          <table class="table table-striped">
            <thead>
              <tr ng-if= "names.length > 0">
               <th>S.No</th>
                <th>Order Id</th>
                <th>Customer Name</th>
                   <th>Customer Contact</th>
                      <th>Delivery Status</th>
                         <th>Delivery Date</th>
                            <th>Pending Amount</th>
              </tr>
            </thead>
            <tbody>
        
            <tr ng-repeat="x in names" >
       
     <td>{{ $index+1 }}</td>
    <td>{{ x.orderId }}</td>
    <input type="hidden" ng-if="$index == editIndex"  value="{{x.orderId}}" name="orderId" id="orderId"/>
   	
    <td ng-if="$index != editIndex">{{ x.customerName }}</td>
    <td ng-if="$index == editIndex"><input type="text" class="form-control col-sm-1" style="width:auto;" value="{{x.customerName}}" name="customerName" id="customerName"/>
   	</td>
    <td ng-if="$index != editIndex">{{ x.customerContact }}</td>
     <td ng-if="$index == editIndex"><input type="text" class="form-control col-sm-1" style="width:auto;" value="{{x.customerContact}}" name="customerContact" id="customerContact"/>
   	</td>
   
    <td ng-if="$index != editIndex">{{ x.deliveryStatus }} </td>
  <td ng-if="$index == editIndex"> 
   <select  class="form-control col-sm-1" style="width:auto;" name="deliveryStatus" id="deliveryStatus" >

<option ng-selected="isSelected(x.deliveryStatus,'NOT STARTED')" value="NOT STARTED">NOT STARTED</option>
<option ng-selected="isSelected(x.deliveryStatus,'IN PROGRESS')"  value="IN PROGRESS">IN PROGRESS</option>
<option ng-selected="isSelected(x.deliveryStatus,'READY FOR PICKUP')" value="READY FOR PICKUP">READY FOR PICKUP</option>
<option ng-selected="isSelected(x.deliveryStatus,'DELIVERED')"  value="DELIVERED">DELIVERED</option>
</select>

</td>

    
    <td ng-if="$index != editIndex">{{ x.deliveryDate }}</td>
     <td ng-if="$index == editIndex"><input type="text" class="form-control col-sm-1" style="width:auto;" value="{{x.deliveryDate}}" name=deliveryDate id="deliveryDate" ng-focus="datePicker()"/>
   	</td>
   
    <td ng-if="$index != editIndex">{{ x.pendingAmount }}</td>
     <td ng-if="$index == editIndex"><input type="text" class="form-control col-sm-1" style="width:auto;" value="{{x.pendingAmount}}" name="pendingAmount" id="pendingAmount"/>
   	</td>
   
    <td  ng-if="$index != editIndex"> <button  id="editOrderBtn" type="button" class="btn btn btn-primary col-sm-1" style="width:auto"; ng-click="editOrders(names.indexOf(x))" font-weight:bold;">Edit</button></td>
    <td  ng-if="$index == editIndex"> <button  id="updateOrderBtn" type="button" class="btn btn btn-primary col-sm-1" style="width:auto"; ng-click="updateOrders(x.orderId)" font-weight:bold;">Update</button></td>
       <td  ng-if="$index == editIndex"> <button  id="updateCancelOrderBtn" type="button" class="btn btn btn-danger col-sm-1" style="width:auto"; ng-click="cancelUpdateOrders()" font-weight:bold;">Cancel</button></td>
 
<td> <button  id="sendSMSBtn" type="button" class="btn btn btn-primary col-sm-1" style="width:auto"; ng-click="sendSMS(names.indexOf(x))" font-weight:bold;">Send SMS</button></td>
  </tr>   
        
            </tbody>
          </table>
             </form>
      <!-- </div> -->  
      </div>
      </div>

    </div> <!-- /container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script src="../../assets/js/docs.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
     <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular.min.js"></script>
  
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	
<script type="text/javascript">
	var app = angular.module('myApp', []);
	app.controller('customersCtrl', function($scope, $http) {
		$('#successMsg').hide();
		$('#errorMsg').hide();
		
			
	   $scope.searchRecords = function() {
			$scope.editIndex = -1;
		   var formdata = $("#searchOrderForm").serialize();
		   $scope.searchCriteria = formdata;
	
		   $http({method : "POST",
		   url :"recordController", 
		   data :formdata,
		   headers : {
			'Content-Type' : 'application/x-www-form-urlencoded'   
		   }
		   }
		   ).success(function (response) {
				 
		
			  if (response.statusMessage == 'success') {
			   $scope.names = response.orders;
			   $('#successMsg').text("Number of orders found:"+ response.orders.length);
			   $('#successMsg').show();
			   } 
			   
		   }).error(function(error, status){
			  
				   $('#errorMsg').show();
				   
			   
		   });
	};
	
	 $scope.updateOrders = function() {

		   var formdata = $("#updateOrdersForm").serialize();
		 
		   $http({method : "POST",
		   url :"recordController", 
		   data :formdata,
		   headers : {
			'Content-Type' : 'application/x-www-form-urlencoded'   
		   }
		   }
		   ).then(function (response) {
		
			   if (response.status == '200' && response.data.statusMessage == 'success') {
				   alert("Order Information updated for Order Id:"+ response.data.orders[0].orderId);
				   $scope.editIndex = -1;
				   $http({method : "POST",
				   url :"recordController", 
				   data :$scope.searchCriteria,
				   headers : {
					'Content-Type' : 'application/x-www-form-urlencoded'   
				   }
				   }
				   ).then(function (response) {
				
					   
					   $scope.names = response.data.orders;
					   $('#successMsg').text("Number of orders found:"+ response.data.orders.length);
					   $('#successMsg').show();});
			
				  
				   
			   } 
			
				
			   });
	};
	
	
	 $scope.sendSMS = function(msgIndex) {
		 
		  var names = $scope.names;
		
		   $http({method : "POST",
		   url :"recordController", 
		   data :'pageAction=sendSMS&customerName='+names[msgIndex].customerName+'&customerContact='+names[msgIndex].customerContact,
		   headers : {
			'Content-Type' : 'application/x-www-form-urlencoded'   
		   }
		   }
		   ).success(function (response) {
				 
		
			  if (response.statusMessage == 'success') {
			 alert("Message Sent Successfully...")
			   } 
			   
		   }).error(function(error, status){
			  
				 alert("Issue while sending SMS...")
			   
		   });
	};
	
	$scope.editOrders = function(ind) {
		$scope.editIndex = ind;

	};
	
	$scope.cancelUpdateOrders = function() {
		$scope.editIndex = -1;

	};
	
	$scope.isSelected = function(x,y) {
		  return (x == y);
		};


		$scope.datePicker = function() {	
			$('#deliveryDate').datepicker({ dateFormat: 'dd-mm-yy' });
			};

	}
	
	);
	

	
	
	
</script>
  </body>
</html>
